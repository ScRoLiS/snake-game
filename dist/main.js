(()=>{"use strict";var t,e;!function(t){t.UP="UP",t.DOWN="DONW",t.LEFT="LEFT",t.RIGHT="RIGHT"}(t||(t={})),function(t){t.UP="ArrowUp",t.DOWN="ArrowDown",t.LEFT="ArrowLeft",t.RIGHT="ArrowRight"}(e||(e={}));var n,i=function(){function t(t,e){this.setX(t),this.setY(e),this.setColor(c.config.bodyColor)}return t.prototype.render=function(t){var e=c.config.partSize;t.fillStyle=this.color,t.fillRect(this.x*e,this.y*e,e,e),t.strokeStyle=c.config.bgColor,t.lineWidth=2.5,t.strokeRect(this.x*e+5,this.y*e+5,e-10,e-10),t.lineWidth=2.5,t.strokeRect(this.x*e,this.y*e,e,e)},t.prototype.setX=function(t){this.x=t},t.prototype.setY=function(t){this.y=t},t.prototype.setColor=function(t){this.color=t},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t}(),o=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.setColor(c.config.headColor),i}return o(e,t),e}(i),s=function(){function n(e,n){this.keyBePressed=!1,this.snake=new Array,this.snakeHead=new r(e,n),this.addPart(this.snakeHead),this.setDirection(t.UP),window.addEventListener("keydown",this.keyPressed.bind(this))}return n.createSnake=function(t,e,o){for(var r=new n(e,o),s=0;s<t;s++)r.addPart(new i(e,o+1));return r},n.prototype.render=function(t){(function(t,e,n){if(n||2===arguments.length)for(var i,o=0,r=e.length;o<r;o++)!i&&o in e||(i||(i=Array.prototype.slice.call(e,0,o)),i[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))})([],this.snake,!0).reverse().forEach((function(e){e.render(t)}))},n.prototype.addPart=function(t){this.snake.push(t)},n.prototype.getLastX=function(){return this.snake[this.snake.length-1].getX()},n.prototype.getLastY=function(){return this.snake[this.snake.length-1].getY()},n.prototype.getLength=function(){return this.snake.length},n.prototype.setDirection=function(t){this.direction=t},n.prototype.checkFoodCollision=function(t){return this.snakeHead.getX()===t.getX()&&this.snakeHead.getY()===t.getY()},n.prototype.checkWallCollision=function(){var t=c.config,e=t.width,n=t.height,i=t.partSize,o=t.wallCollision,r=e/i-1,s=n/i-1;if(this.snakeHead.getX()<0){if(o)return!0;this.snakeHead.setX(r)}if(this.snakeHead.getX()>r){if(o)return!0;this.snakeHead.setX(0)}if(this.snakeHead.getY()<0){if(o)return!0;this.snakeHead.setY(s)}if(this.snakeHead.getY()>s){if(o)return!0;this.snakeHead.setY(0)}return!1},n.prototype.checkBodyCollision=function(){for(var t=1;t<this.snake.length;t++)if(this.snakeHead.getX()===this.snake[t].getX()&&this.snakeHead.getY()===this.snake[t].getY())return!0;return!1},n.prototype.moveUp=function(){this.snakeHead.setY(this.snakeHead.getY()-1)},n.prototype.moveDown=function(){this.snakeHead.setY(this.snakeHead.getY()+1)},n.prototype.moveLeft=function(){this.snakeHead.setX(this.snakeHead.getX()-1)},n.prototype.moveRight=function(){this.snakeHead.setX(this.snakeHead.getX()+1)},n.prototype.moveSnake=function(){for(var e=this.snake.length-1;e>0;e--)this.snake[e].setY(this.snake[e-1].getY()),this.snake[e].setX(this.snake[e-1].getX());switch(this.direction){case t.UP:this.moveUp();break;case t.DOWN:this.moveDown();break;case t.LEFT:this.moveLeft();break;case t.RIGHT:this.moveRight()}this.keyBePressed=!1},n.prototype.keyPressed=function(n){if(!this.keyBePressed)switch(this.keyBePressed=!0,n.key){case e.UP:this.direction!==t.DOWN&&this.setDirection(t.UP);break;case e.DOWN:this.direction!==t.UP&&this.setDirection(t.DOWN);break;case e.LEFT:this.direction!==t.RIGHT&&this.setDirection(t.LEFT);break;case e.RIGHT:this.direction!==t.LEFT&&this.setDirection(t.RIGHT)}},n}(),a=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),h=function(t){function e(){var e=t.call(this,3,3)||this;return e.setColor("#0a4622"),e}return a(e,t),e.prototype.generateNewPosition=function(t){var e,n,i=c.config,o=i.width,r=i.height,s=i.partSize,a=o/s-1,h=r/s-1,f=t.snake;do{e=Math.round(Math.random()*a),n=Math.round(Math.random()*h);for(var l=0;l<f.length;l++)if(e===f[l].getX()&&n===f[l].getY()){e=null,n=null;break}}while(null===e&&null===n);this.setX(e),this.setY(n)},e}(i),c=function(){function t(e,n){this.score=0;var i=n.width,o=n.height,r=i%2?Math.round(i/2-1):i/2,a=o%2?Math.round(o/2-1):o/2;n.width=n.width*n.partSize,n.height=n.height*n.partSize,e.setAttribute("width",n.width.toString()),e.setAttribute("height",n.height.toString()),t.config=n,this.canvas=e.getContext("2d"),this.snake=s.createSnake(n.snakeLength,r,a),this.food=new h,this.food.generateNewPosition(this.snake)}return t.prototype.render=function(e){this.clearCanvas(e),this.food.render(e),this.snake.render(e),t.config.grid&&this.renderGrid(e)},t.prototype.clearCanvas=function(e){var n=t.config,i=n.width,o=n.height;e.fillStyle=t.config.bgColor,e.fillRect(0,0,i,o)},t.prototype.renderGrid=function(e){var n=t.config,i=n.partSize,o=n.width,r=n.height;e.strokeStyle="#000000",e.lineWidth=1.5;for(var s=0;s<=o/i;s++)e.beginPath(),e.moveTo(s*i,0),e.lineTo(s*i,r),e.stroke();for(s=0;s<=r/i;s++)e.beginPath(),e.moveTo(0,s*i),e.lineTo(o,s*i),e.stroke()},t.prototype.renderLooseScreen=function(e){e.fillStyle="#ffffffaa",e.fillRect(0,0,t.config.width,t.config.height),e.fillStyle="#aa0000",e.textAlign="center",e.font="30px sans-serif",e.fillText("You loose!",t.config.width/2,t.config.height/2),e.font="15px sans-serif",e.fillText("Score: ".concat(this.score),t.config.width/2,t.config.height/2+24)},t.prototype.renderWinScreen=function(e){e.fillStyle="#ffffffaa",e.fillRect(0,0,t.config.width,t.config.height),e.fillStyle="#008a00",e.textAlign="center",e.font="30px sans-serif",e.fillText("You win!",t.config.width/2,t.config.height/2),e.font="15px sans-serif",e.fillText("Score: ".concat(this.score),t.config.width/2,t.config.height/2+24)},t.prototype.win=function(){console.log("WIN!","SCORE:",this.score),this.render(this.canvas),this.renderWinScreen(this.canvas),this.stop()},t.prototype.lose=function(){console.log("FAIL!","SCORE:",this.score),this.renderLooseScreen(this.canvas),this.stop()},t.prototype.gamePlay=function(){var e=t.config,n=e.width,o=e.height,r=e.partSize,s=n/r*(o/r);this.snake.moveSnake(),this.snake.getLength()>=s?this.win():this.snake.checkBodyCollision()||this.snake.checkWallCollision()?this.lose():this.snake.checkFoodCollision(this.food)&&this.snake.getLength()<s&&(this.snake.addPart(new i(this.snake.getLastX(),this.snake.getLastY())),this.food.generateNewPosition(this.snake),this.score++)},t.prototype.start=function(){this.gamePlayId=setInterval(this.gamePlay.bind(this),t.config.gameSpeed),this.renderId=setInterval(this.render.bind(this,this.canvas),1)},t.prototype.stop=function(){clearInterval(this.gamePlayId),clearInterval(this.renderId)},t}(),f=function(){return f=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},f.apply(this,arguments)},l=document.getElementById("config"),g=document.getElementById("canvas"),d=y(l),p=new c(g,f({},d));function u(t){return parseInt(t)}function y(t){var e=new FormData(t),n={};return n.width=u(e.get("width")),n.height=u(e.get("height")),n.partSize=u(e.get("partSize")),n.snakeLength=u(e.get("snakeLength")),n.gameSpeed=u(e.get("gameSpeed")),n.grid=!!e.get("grid"),n.wallCollision=!!e.get("wallCollision"),n.bgColor=e.get("bgColor").toString(),n.headColor=e.get("headColor").toString(),n.bodyColor=e.get("bodyColor").toString(),n}l.addEventListener("input",(function(){d=y(l)})),l.addEventListener("submit",(function(t){t.preventDefault(),p.stop(),(p=new c(g,f({},d))).start()})),p.start()})();